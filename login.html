<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Face Authentication</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #6200ee;
            --secondary-color: #03dac6;
            --background-dark: #121212;
            --surface-dark: #1e1e1e;
            --error-color: #cf6679;
            --success-color: #00c853;
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.7);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: var(--background-dark);
            overflow: hidden;
            position: relative;
            color: var(--text-primary);
        }

        .particles-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        .login-container {
            position: relative;
            width: 90%;
            max-width: 500px;
            background-color: rgba(30, 30, 30, 0.85);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            z-index: 2;
            display: flex;
            flex-direction: column;
            align-items: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .login-header {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
        }

        .login-header i {
            font-size: 28px;
            margin-right: 10px;
            color: var(--secondary-color);
        }

        .login-header h1 {
            font-size: 28px;
            font-weight: 600;
            letter-spacing: 1px;
            color: var(--text-primary);
            text-transform: uppercase;
        }

        .scanner-container {
            position: relative;
            width: 280px;
            height: 280px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 30px;
        }

        .scanner {
            position: relative;
            width: 100%;
            height: 100%;
            border-radius: 20px;
            background-color: rgba(0, 0, 0, 0.5);
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 2px solid rgba(98, 0, 238, 0.3);
            transition: all 0.3s ease;
        }

        .scanner:hover {
            transform: scale(1.02);
            border-color: var(--secondary-color);
        }

        .scanner-ring {
            position: absolute;
            top: -5px;
            left: -5px;
            right: -5px;
            bottom: -5px;
            border-radius: 25px;
            border: 2px solid transparent;
            border-top: 2px solid var(--secondary-color);
            border-right: 2px solid transparent;
            border-bottom: 2px solid var(--secondary-color);
            border-left: 2px solid transparent;
            animation: rotate 4s linear infinite;
            pointer-events: none;
        }

        .camera-feed {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 18px;
            opacity: 0.9;
            transition: all 0.3s ease;
        }

        .scan-box {
            position: absolute;
            width: 180px;
            height: 220px;
            border: 2px solid var(--secondary-color);
            border-radius: 15px;
            box-shadow: 0 0 10px rgba(3, 218, 198, 0.5);
            animation: pulse 2s infinite;
            pointer-events: none;
        }

        .scan-line {
            position: absolute;
            width: 100%;
            height: 3px;
            background-color: var(--secondary-color);
            animation: scan 3s ease-in-out infinite;
            box-shadow: 0 0 15px rgba(3, 218, 198, 0.7);
            pointer-events: none;
        }

        .corner-markers {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .corner {
            position: absolute;
            width: 20px;
            height: 20px;
            border: 2px solid var(--secondary-color);
        }

        .corner-top-left {
            top: 20px;
            left: 20px;
            border-right: none;
            border-bottom: none;
            border-radius: 5px 0 0 0;
        }

        .corner-top-right {
            top: 20px;
            right: 20px;
            border-left: none;
            border-bottom: none;
            border-radius: 0 5px 0 0;
        }

        .corner-bottom-left {
            bottom: 20px;
            left: 20px;
            border-right: none;
            border-top: none;
            border-radius: 0 0 0 5px;
        }

        .corner-bottom-right {
            bottom: 20px;
            right: 20px;
            border-left: none;
            border-top: none;
            border-radius: 0 0 5px 0;
        }

        .face-overlay {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .status-container {
            position: relative;
            width: 100%;
            margin-bottom: 25px;
        }

        .status-text {
            text-align: center;
            color: var(--secondary-color);
            font-size: 18px;
            font-weight: 500;
            letter-spacing: 1px;
            margin-bottom: 5px;
            height: 24px;
            transition: all 0.3s ease;
        }

        .status-details {
            text-align: center;
            color: var(--text-secondary);
            font-size: 14px;
            max-width: 80%;
            margin: 0 auto;
            opacity: 0.8;
            height: 18px;
        }

        .progress-container {
            width: 100%;
            height: 6px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            margin-top: 15px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            width: 0%;
            background-color: var(--secondary-color);
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .auth-button {
            position: relative;
            padding: 15px 30px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            letter-spacing: 1px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(98, 0, 238, 0.3);
            width: 240px;
        }

        .auth-button:hover {
            background-color: #7928ca;
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(98, 0, 238, 0.4);
        }

        .auth-button:active {
            transform: translateY(1px);
        }

        .auth-button i {
            margin-right: 10px;
            font-size: 18px;
        }

        .auth-button .button-loader {
            position: absolute;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 3px solid white;
            animation: rotate 1s linear infinite;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .auth-button.loading .button-text {
            opacity: 0;
        }

        .auth-button.loading .button-loader {
            opacity: 1;
        }

        .controls {
            display: flex;
            justify-content: center;
            margin-top: 20px;
            width: 100%;
        }

        .control-button {
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--text-secondary);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .control-button:hover {
            background-color: rgba(255, 255, 255, 0.2);
            color: var(--text-primary);
            transform: translateY(-2px);
        }

        .face-mesh {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 0.5s ease;
            pointer-events: none;
        }

        .biometric-dots {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .auth-methods {
            margin-top: 30px;
            display: flex;
            gap: 15px;
        }

        .auth-method {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            opacity: 0.5;
            transition: all 0.3s ease;
        }

        .auth-method:hover {
            opacity: 1;
        }

        .auth-method.active {
            opacity: 1;
        }

        .auth-method i {
            font-size: 20px;
            color: var(--text-primary);
            background-color: rgba(255, 255, 255, 0.1);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 8px;
            transition: all 0.3s ease;
        }

        .auth-method.active i {
            background-color: var(--primary-color);
            box-shadow: 0 0 15px rgba(98, 0, 238, 0.5);
        }

        .auth-method span {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: var(--surface-dark);
            border-left: 4px solid var(--secondary-color);
            border-radius: 5px;
            padding: 15px 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            transform: translateX(120%);
            transition: transform 0.3s ease;
            z-index: 100;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification i {
            font-size: 20px;
            margin-right: 15px;
            color: var(--secondary-color);
        }

        .notification-content {
            display: flex;
            flex-direction: column;
        }

        .notification-title {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .notification-message {
            font-size: 14px;
            color: var(--text-secondary);
        }

        @keyframes rotate {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        @keyframes scan {
            0%, 100% {
                top: 5%;
                opacity: 0.5;
            }
            50% {
                top: 95%;
                opacity: 1;
            }
        }

        @keyframes pulse {
            0%, 100% {
                box-shadow: 0 0 10px rgba(3, 218, 198, 0.5);
            }
            50% {
                box-shadow: 0 0 20px rgba(3, 218, 198, 0.8);
            }
        }

        @keyframes notification {
            0% {
                opacity: 0;
                transform: translateY(-20px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Responsive styles */
        @media (max-width: 600px) {
            .login-container {
                padding: 30px 20px;
            }

            .scanner-container {
                width: 240px;
                height: 240px;
            }

            .login-header h1 {
                font-size: 24px;
            }

            .auth-button {
                width: 200px;
                padding: 12px 20px;
            }
        }

        /* Dark mode enhancement */
        @media (prefers-color-scheme: dark) {
            :root {
                --background-dark: #0a0a0a;
                --surface-dark: #121212;
            }
        }
    </style>
</head>
<body>
    <div class="particles-container" id="particles"></div>

    <div class="login-container">
        <div class="login-header">
            <i class="fas fa-shield-alt"></i>
            <h1>Face Authentication</h1>
        </div>
        
        <div class="scanner-container">
            <div class="scanner" id="scanner">
                <video class="camera-feed" id="cameraFeed" autoplay muted playsinline></video>
                <div class="scan-line"></div>
                <div class="scanner-ring"></div>
                <div class="scan-box"></div>
                
                <div class="corner-markers">
                    <div class="corner corner-top-left"></div>
                    <div class="corner corner-top-right"></div>
                    <div class="corner corner-bottom-left"></div>
                    <div class="corner corner-bottom-right"></div>
                </div>
                
                <div class="face-overlay" id="faceOverlay"></div>
                <div class="face-mesh" id="faceMesh"></div>
                <div class="biometric-dots" id="biometricDots"></div>
            </div>
        </div>
        
        <div class="status-container">
            <div class="status-text" id="statusText">Waiting for camera...</div>
            <div class="status-details" id="statusDetails">Please enable camera access</div>
            <div class="progress-container">
                <div class="progress-bar" id="progressBar"></div>
            </div>
        </div>
        
        <button class="auth-button" id="authButton">
            <span class="button-loader"></span>
            <span class="button-text"><i class="fas fa-camera"></i>Scan Face</span>
        </button>
        
        <div class="controls">
            <button class="control-button" id="toggleMeshBtn" title="Toggle Face Mesh">
                <i class="fas fa-fingerprint"></i>
            </button>
            <button class="control-button" id="takePhotoBtn" title="Take Photo">
                <i class="fas fa-camera"></i>
            </button>
            <button class="control-button" id="helpBtn" title="Help">
                <i class="fas fa-question"></i>
            </button>
        </div>

        <div class="auth-methods">
            <div class="auth-method active" id="faceAuth">
                <i class="fas fa-user"></i>
                <span>Face ID</span>
            </div>
            <div class="auth-method" id="fingerprintAuth">
                <i class="fas fa-fingerprint"></i>
                <span>Fingerprint</span>
            </div>
            <div class="auth-method" id="passwordAuth">
                <i class="fas fa-key"></i>
                <span>Password</span>
            </div>
        </div>
    </div>

    <div class="notification" id="notification">
        <i class="fas fa-info-circle"></i>
        <div class="notification-content">
            <div class="notification-title" id="notificationTitle">Status Update</div>
            <div class="notification-message" id="notificationMessage">This is a notification message.</div>
        </div>
    </div>

    <script>
        // DOM Elements
        const cameraFeed = document.getElementById('cameraFeed');
        const scanner = document.getElementById('scanner');
        const statusText = document.getElementById('statusText');
        const statusDetails = document.getElementById('statusDetails');
        const progressBar = document.getElementById('progressBar');
        const authButton = document.getElementById('authButton');
        const faceMesh = document.getElementById('faceMesh');
        const faceOverlay = document.getElementById('faceOverlay');
        const biometricDots = document.getElementById('biometricDots');
        const toggleMeshBtn = document.getElementById('toggleMeshBtn');
        const takePhotoBtn = document.getElementById('takePhotoBtn');
        const helpBtn = document.getElementById('helpBtn');
        const notification = document.getElementById('notification');
        const notificationTitle = document.getElementById('notificationTitle');
        const notificationMessage = document.getElementById('notificationMessage');
        const authMethods = document.querySelectorAll('.auth-method');

        // State variables
        let isMeshVisible = false;
        let faceDetected = false;
        let isAuthenticating = false;
        let authProgress = 0;
        let progressInterval;
        let cameraStream = null;
        let faceDots = [];
        let particleSystem = [];

        // Auth method selection
        authMethods.forEach(method => {
            method.addEventListener('click', () => {
                authMethods.forEach(m => m.classList.remove('active'));
                method.classList.add('active');
                
                // Update UI based on selected auth method
                if (method.id === 'faceAuth') {
                    authButton.querySelector('.button-text').innerHTML = '<i class="fas fa-camera"></i>Scan Face';
                    showNotification('Authentication Method', 'Face recognition selected');
                } else if (method.id === 'fingerprintAuth') {
                    authButton.querySelector('.button-text').innerHTML = '<i class="fas fa-fingerprint"></i>Scan Fingerprint';
                    showNotification('Authentication Method', 'Fingerprint authentication selected');
                } else if (method.id === 'passwordAuth') {
                    authButton.querySelector('.button-text').innerHTML = '<i class="fas fa-key"></i>Enter Password';
                    showNotification('Authentication Method', 'Password authentication selected');
                }
            });
        });

        // Create particles for background
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            const canvas = document.createElement('canvas');
            particlesContainer.appendChild(canvas);
            const ctx = canvas.getContext('2d');
            
            // Resize canvas to window size
            function resizeCanvas() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            }
            
            window.addEventListener('resize', resizeCanvas);
            resizeCanvas();
            
            // Create particles
            for (let i = 0; i < 150; i++) {
                particleSystem.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    size: Math.random() * 3 + 1,
                    speedX: (Math.random() - 0.5) * 0.8,
                    speedY: (Math.random() - 0.5) * 0.8,
                    opacity: Math.random() * 0.5 + 0.2,
                    color: Math.random() > 0.5 ? '#6200ee' : '#03dac6'
                });
            }
            
            function drawParticles() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Draw connections between particles
                ctx.beginPath();
                for (let i = 0; i < particleSystem.length; i++) {
                    const p1 = particleSystem[i];
                    for (let j = i + 1; j < particleSystem.length; j++) {
                        const p2 = particleSystem[j];
                        const distance = Math.sqrt(Math.pow(p1.x - p2.x, 2) + Math.pow(p1.y - p2.y, 2));
                        if (distance < 100) {
                            ctx.beginPath();
                            ctx.strokeStyle = `rgba(3, 218, 198, ${0.1 * (1 - distance / 100)})`;
                            ctx.lineWidth = 1;
                            ctx.moveTo(p1.x, p1.y);
                            ctx.lineTo(p2.x, p2.y);
                            ctx.stroke();
                        }
                    }
                }
                
                // Draw particles
                particleSystem.forEach(particle => {
                    ctx.beginPath();
                    ctx.fillStyle = particle.color.replace(')', `, ${particle.opacity})`);
                    ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // Update position
                    particle.x += particle.speedX;
                    particle.y += particle.speedY;
                    
                    // Wrap around the screen
                    if (particle.x < 0) particle.x = canvas.width;
                    if (particle.x > canvas.width) particle.x = 0;
                    if (particle.y < 0) particle.y = canvas.height;
                    if (particle.y > canvas.height) particle.y = 0;
                });
                
                requestAnimationFrame(drawParticles);
            }
            
            drawParticles();
        }

        // Generate face mesh dots
        function generateFaceMesh() {
            faceMesh.innerHTML = '';
            
            // Define facial feature points (more realistic distribution)
            const facePoints = [
                // Head outline points
                {x: 0.20, y: 0.15}, {x: 0.15, y: 0.20}, {x: 0.12, y: 0.30}, 
                {x: 0.10, y: 0.40}, {x: 0.09, y: 0.50}, {x: 0.10, y: 0.60}, 
                {x: 0.12, y: 0.70}, {x: 0.15, y: 0.80}, {x: 0.20, y: 0.85}, 
                {x: 0.30, y: 0.88}, {x: 0.40, y: 0.90}, {x: 0.50, y: 0.90}, 
                {x: 0.60, y: 0.90}, {x: 0.70, y: 0.88}, {x: 0.80, y: 0.85}, 
                {x: 0.85, y: 0.80}, {x: 0.88, y: 0.70}, {x: 0.90, y: 0.60}, 
                {x: 0.91, y: 0.50}, {x: 0.90, y: 0.40}, {x: 0.88, y: 0.30}, 
                {x: 0.85, y: 0.20}, {x: 0.80, y: 0.15},
                
                // Eyes
                // Left eye
                {x: 0.30, y: 0.35}, {x: 0.35, y: 0.33}, {x: 0.40, y: 0.35},
                {x: 0.35, y: 0.37},
                // Right eye
                {x: 0.60, y: 0.35}, {x: 0.65, y: 0.33}, {x: 0.70, y: 0.35},
                {x: 0.65, y: 0.37},
                
                // Eyebrows
                {x: 0.25, y: 0.30}, {x: 0.30, y: 0.28}, {x: 0.35, y: 0.28}, {x: 0.40, y: 0.30},
                {x: 0.60, y: 0.30}, {x: 0.65, y: 0.28}, {x: 0.70, y: 0.28}, {x: 0.75, y: 0.30},
                
                // Nose
                {x: 0.50, y: 0.45}, {x: 0.50, y: 0.50}, {x: 0.50, y: 0.55},
                {x: 0.45, y: 0.55}, {x: 0.50, y: 0.55}, {x: 0.55, y: 0.55},
                
                // Mouth
                {x: 0.35, y: 0.70}, {x: 0.40, y: 0.68}, {x: 0.45, y: 0.67},
                {x: 0.50, y: 0.68}, {x: 0.55, y: 0.67}, {x: 0.60, y: 0.68},
                {x: 0.65, y: 0.70}, {x: 0.60, y: 0.72}, {x: 0.55, y: 0.73},
                {x: 0.50, y: 0.72}, {x: 0.45, y: 0.73}, {x: 0.40, y: 0.72},
                
                // Jaw details
                {x: 0.25, y: 0.60}, {x: 0.25, y: 0.70}, {x: 0.25, y: 0.80},
                {x: 0.75, y: 0.60}, {x: 0.75, y: 0.70}, {x: 0.75, y: 0.80}
            ];
            
            // Add facial landmark points with adjustments for randomization
            faceDots = facePoints.map(point => {
                const jitter = () => (Math.random() - 0.5) * 0.02;
                
                return {
                    x: point.x + jitter(),
                    y: point.y + jitter(),
                    size: Math.random() * 2 + 1,
                    initialX: point.x,
                    initialY: point.y
                };
            });
            
            // Create connections between nearby points
            const connections = [];
            for (let i = 0; i < faceDots.length; i++) {
                for (let j = i + 1; j < faceDots.length; j++) {
                    const p1 = faceDots[i];
                    const p2 = faceDots[j];
                    const distance = Math.sqrt(Math.pow(p1.initialX - p2.initialX, 2) + Math.pow(p1.initialY - p2.initialY, 2));
                    if (distance < 0.12) {
                        connections.push([i, j]);
                    }
                }
            }
            
            // Add SVG elements for the face mesh
            const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            svg.setAttribute("width", "100%");
            svg.setAttribute("height", "100%");
            faceMesh.appendChild(svg);
            
            // Add connections first (to be under the dots)
            connections.forEach(([i, j]) => {
                const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
                line.setAttribute("x1", `${faceDots[i].x * 100}%`);
                line.setAttribute("y1", `${faceDots[i].y * 100}%`);
                line.setAttribute("x2", `${faceDots[j].x * 100}%`);
                line.setAttribute("y2", `${faceDots[j].y * 100}%`);
                line.setAttribute("stroke", "rgba(3, 218, 198, 0.6)");
                line.setAttribute("stroke-width", "1");
                svg.appendChild(line);
            });
            
            // Add dots
            faceDots.forEach(dot => {
                const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                circle.setAttribute("cx", `${dot.x * 100}%`);
                circle.setAttribute("cy", `${dot.y * 100}%`);
                circle.setAttribute("r", `${dot.size}`);
                circle.setAttribute("fill", "rgba(3, 218, 198, 0.8)");
                svg.appendChild(circle);
            });
            
            // Add random biometric scanning points
            generateBiometricDots();
        }
        
        // Generate randomized biometric scanning points
        function generateBiometricDots() {
            biometricDots.innerHTML = '';
            
            // Create an SVG element
            const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            svg.setAttribute("width", "100%");
            svg.setAttribute("height", "100%");
            biometricDots.appendChild(svg);
            
            // Generate 40 random dots across the face area
            for (let i = 0; i < 40; i++) {
                // Focus most dots on the center of the face
                let x, y;
                if (i % 3 === 0) {
                    // Completely random position
                    x = Math.random();
                    y = Math.random();
                } else {
                    // More centered position
                    x = 0.3 + Math.random() * 0.4;
                    y = 0.2 + Math.random() * 0.6;
                }
                
                const size = Math.random() * 3 + 1;
                
                const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                circle.setAttribute("cx", `${x * 100}%`);
                circle.setAttribute("cy", `${y * 100}%`);
                circle.setAttribute("r", size);
                circle.setAttribute("fill", "rgba(98, 0, 238, 0.6)");
                
                // Add pulse animation
                const animateSize = document.createElementNS("http://www.w3.org/2000/svg", "animate");
                animateSize.setAttribute("attributeName", "r");
                animateSize.setAttribute("values", `${size};${size * 1.5};${size}`);
                animateSize.setAttribute("dur", `${Math.random() * 2 + 1}s`);
                animateSize.setAttribute("repeatCount", "indefinite");
                
                const animateOpacity = document.createElementNS("http://www.w3.org/2000/svg", "animate");
                animateOpacity.setAttribute("attributeName", "opacity");
                animateOpacity.setAttribute("values", "0.6;0.9;0.6");
                animateOpacity.setAttribute("dur", `${Math.random() * 2 + 1}s`);
                animateOpacity.setAttribute("repeatCount", "indefinite");
                
                circle.appendChild(animateSize);
                circle.appendChild(animateOpacity);
                svg.appendChild(circle);
            }
        }

        // Show notification
        function showNotification(title, message) {
            notificationTitle.textContent = title;
            notificationMessage.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Toggle face mesh visibility
        toggleMeshBtn.addEventListener('click', () => {
            isMeshVisible = !isMeshVisible;
            faceMesh.style.opacity = isMeshVisible ? '1' : '0';
            if (isMeshVisible) {
                showNotification('Face Mesh Enabled', 'Biometric points visualization active');
            } else {
                showNotification('Face Mesh Disabled', 'Biometric points visualization disabled');
            }
        });

        // Take photo simulation
        takePhotoBtn.addEventListener('click', () => {
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            canvas.width = cameraFeed.videoWidth;
            canvas.height = cameraFeed.videoHeight;
            
            if (cameraFeed.videoWidth > 0) {
                // Flash effect
                scanner.style.boxShadow = '0 0 50px white';
                setTimeout(() => {
                    scanner.style.boxShadow = '';
                }, 200);
                
                context.drawImage(cameraFeed, 0, 0, canvas.width, canvas.height);
                showNotification('Photo Captured', 'Face image saved for verification');
            } else {
                showNotification('Camera Error', 'Unable to capture image. Please check camera.');
            }
        });

        // Help button
        helpBtn.addEventListener('click', () => {
            showNotification('Help Info', 'Position your face within the frame for authentication');
        });

        // Setup camera
        async function setupCamera() {
            try {
                // Request camera with high resolution if available
                const constraints = {
                    video: {
                        width: { ideal: 1280 },
                        height: { ideal: 720 },
                        facingMode: 'user'
                    }
                };
                
                cameraStream = await navigator.mediaDevices.getUserMedia(constraints);
                cameraFeed.srcObject = cameraStream;
                
                statusText.textContent = "Position your face";
                statusDetails.textContent = "Center your face in the frame";
                
                // Simulate face detection after camera loads
                cameraFeed.onloadedmetadata = () => {
                    setTimeout(simulateFaceDetection, 2000);
                };
                
                return true;
            } catch (error) {
                console.error('Error accessing camera:', error);
                statusText.textContent = "Camera access denied";
                statusDetails.textContent = "Please enable camera access in your browser";
                showNotification('Camera Error', 'Unable to access camera. Check permissions.');
                return false;
            }
        }

        // Simulate face detection
        function simulateFaceDetection() {
            if (Math.random() > 0.2) { // 80% chance of detection
                faceDetected = true;
                statusText.textContent = "Face detected";
                statusDetails.textContent = "Ready for authentication";
                showNotification('Face Detected', 'Your face is now properly positioned');
                generateFaceMesh();
            } else {
                statusText.textContent = "Face not detected";
                statusDetails.textContent = "Please center your face in the frame";
                setTimeout(simulateFaceDetection, 2000);
            }
        }

        // Start authentication process
        function startAuthentication() {
            if (isAuthenticating) return;
            
            if (!cameraStream) {
                setupCamera().then(success => {
                    if (success) {
                        showNotification('Camera Active', 'Position your face in the frame');
                    }
                });
                return;
            }
            
            if (!faceDetected) {
                showNotification('No Face Detected', 'Please position your face in the frame');
                statusText.textContent = "No face detected";
                statusDetails.textContent = "Please center your face in the frame";
                return;
            }
            
            isAuthenticating = true;
            authButton.classList.add('loading');
            statusText.textContent = "Authenticating...";
            statusDetails.textContent = "Analyzing facial features";
            
            // Show face mesh during authentication
            faceMesh.style.opacity = '1';
            
            // Reset and animate progress bar
            authProgress = 0;
            progressBar.style.width = '0%';
            
            progressInterval = setInterval(() => {
                authProgress += 2;
                progressBar.style.width = `${authProgress}%`;
                
                // Update status text based on progress
                if (authProgress > 25 && authProgress <= 50) {
                    statusDetails.textContent = "Matching biometric patterns";
                } else if (authProgress > 50 && authProgress <= 75) {
                    statusDetails.textContent = "Verifying identity";
                } else if (authProgress > 75) {
                    statusDetails.textContent = "Finalizing authentication";
                }
                
                if (authProgress >= 100) {
                    clearInterval(progressInterval);
                    completeAuthentication();
                }
            }, 50);
        }

        // Complete authentication
        function completeAuthentication() {
            // Simulate 90% success rate
            const success = Math.random() <= 0.9;
            
            setTimeout(() => {
                authButton.classList.remove('loading');
                
                if (success) {
                    statusText.textContent = "Authentication successful";
                    statusDetails.textContent = "Welcome back, User";
                    progressBar.style.backgroundColor = 'var(--success-color)';
                    authButton.style.backgroundColor = 'var(--success-color)';
                    authButton.querySelector('.button-text').innerHTML = '<i class="fas fa-check"></i>Success';
                    
                    showNotification('Access Granted', 'Authentication successful! Welcome back.');
                    
                    // Simulated redirect after successful login
                    setTimeout(() => {
                            statusText.textContent = "Redirecting to dashboard...";
                            statusDetails.textContent = "Please wait";

                            // Redirect after showing message
                            setTimeout(() => {
                                window.location.href = 'dash.html';
                            }, 1000); // Wait 1 more second before redirecting
                        }, 1500);
                } else {
                    statusText.textContent = "Authentication failed";
                    statusDetails.textContent = "Please try again";
                    progressBar.style.backgroundColor = 'var(--error-color)';
                    showNotification('Access Denied', 'Face verification failed. Please try again.');
                    // Reset after failure
                    setTimeout(() => {
                        progressBar.style.backgroundColor = 'var(--secondary-color)';
                        progressBar.style.width = '0%';
                        statusText.textContent = "Ready to try again";
                        statusDetails.textContent = "Please position your face properly";
                        faceMesh.style.opacity = '0';
                        authButton.style.backgroundColor = 'var(--primary-color)';
                        authButton.querySelector('.button-text').innerHTML = '<i class="fas fa-camera"></i>Retry Scan';
                    }, 2000);
                }
                
                isAuthenticating = false;
            }, 500);
        }

        // Animate face mesh
        function animateFaceMesh() {
            if (!faceMesh.firstChild) return;
            
            const svg = faceMesh.firstChild;
            const lines = svg.querySelectorAll('line');
            const circles = svg.querySelectorAll('circle');
            
            // Update positions with small random movements
            faceDots.forEach((dot, i) => {
                if (isAuthenticating) {
                    // More movement during authentication
                    const jitter = (Math.random() - 0.5) * 0.01;
                    dot.x = dot.initialX + jitter;
                    dot.y = dot.initialY + jitter;
                } else {
                    // Subtle movement otherwise
                    const jitter = (Math.random() - 0.5) * 0.005;
                    dot.x = dot.initialX + jitter;
                    dot.y = dot.initialY + jitter;
                }
                
                // Update circle positions
                if (circles[i]) {
                    circles[i].setAttribute("cx", `${dot.x * 100}%`);
                    circles[i].setAttribute("cy", `${dot.y * 100}%`);
                }
            });
            
            // Update lines
            let lineIndex = 0;
            for (let i = 0; i < faceDots.length; i++) {
                for (let j = i + 1; j < faceDots.length; j++) {
                    const p1 = faceDots[i];
                    const p2 = faceDots[j];
                    const distance = Math.sqrt(Math.pow(p1.initialX - p2.initialX, 2) + Math.pow(p1.initialY - p2.initialY, 2));
                    
                    if (distance < 0.12 && lines[lineIndex]) {
                        lines[lineIndex].setAttribute("x1", `${p1.x * 100}%`);
                        lines[lineIndex].setAttribute("y1", `${p1.y * 100}%`);
                        lines[lineIndex].setAttribute("x2", `${p2.x * 100}%`);
                        lines[lineIndex].setAttribute("y2", `${p2.y * 100}%`);
                        lineIndex++;
                    }
                }
            }
            
            requestAnimationFrame(animateFaceMesh);
        }

        // Authentication button click handler
        authButton.addEventListener('click', startAuthentication);

        // Initialize
        createParticles();
        
        // Start animation loop
        animateFaceMesh();
    </script>
</body>
</html>
